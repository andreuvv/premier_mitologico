import{j as e,o as se,p as ne,q as H,c as P,r as re,s as O}from"./index-DtB_3u9q.js";import{r as d}from"./vendor-CDu7jYU_.js";import{f as oe}from"./fixtureAPI-CCqzuYvt.js";import{A as te}from"./api-BhmblKSE.js";import{R as W,P as z,a as A,C as G,T as V,L as k}from"./recharts-ByW0Dlvs.js";import"./react-icons-CWiluJEb.js";const ce="_container_b94io_1",ie="_mobileHeader_b94io_13",le="_hamburger_b94io_31",de="_mobileTitle_b94io_49",he="_sidebar_b94io_61",me="_sidebarContent_b94io_79",pe="_sidebarTitle_b94io_87",_e="_icon_b94io_105",be="_playersList_b94io_113",ye="_playerButton_b94io_133",ue="_active_b94io_169",fe="_main_b94io_183",xe="_playerDetail_b94io_199",je="_playerHeader_b94io_209",Ne="_playerInfoColumn_b94io_225",ge="_playerProfilePicture_b94io_241",Pe="_playerName_b94io_267",ve="_playerSummary_b94io_285",Ce="_summaryItem_b94io_319",Se="_summaryLabel_b94io_343",Be="_summaryValue_b94io_363",Re="_tournamentsList_b94io_377",Te="_tournamentCard_b94io_389",we="_accordionHeader_b94io_417",Ie="_headerContent_b94io_453",Ee="_tournamentDate_b94io_475",Fe="_chevron_b94io_485",De="_expanded_b94io_497",Me="_tournamentInfo_b94io_505",Le="_standingInfo_b94io_521",$e="_racesInfo_b94io_523",He="_infoRow_b94io_535",Oe="_label_b94io_551",We="_value_b94io_563",ze="_loadingSpinner_b94io_573",Ae="_error_b94io_587",Ge="_noData_b94io_605",Ve="_emptyState_b94io_607",ke="_emptyIcon_b94io_619",Ue="_sidebarOpen_b94io_691",qe="_graphsAccordion_b94io_749",Je="_chartIcon_b94io_819",Ke="_graphsContent_b94io_845",Qe="_chartSection_b94io_861",Xe="_chartSubtitle_b94io_895",Ye="_trophySection_b94io_909",Ze="_trophySectionTitle_b94io_937",ea="_trophyContainer_b94io_953",aa="_trophy_b94io_909",sa="_trophyIcon_b94io_983",na="_goldTrophy_b94io_1001",ra="_silverTrophy_b94io_1009",oa="_bronzeTrophy_b94io_1017",ta="_trophyCount_b94io_1025",a={container:ce,mobileHeader:ie,hamburger:le,mobileTitle:de,sidebar:he,sidebarContent:me,sidebarTitle:pe,icon:_e,playersList:be,playerButton:ye,active:ue,main:fe,playerDetail:xe,playerHeader:je,playerInfoColumn:Ne,playerProfilePicture:ge,playerName:Pe,playerSummary:ve,summaryItem:Ce,summaryLabel:Se,summaryValue:Be,tournamentsList:Re,tournamentCard:Te,accordionHeader:we,headerContent:Ie,tournamentDate:Ee,chevron:Fe,expanded:De,tournamentInfo:Me,standingInfo:Le,racesInfo:$e,infoRow:He,label:Oe,value:We,loadingSpinner:ze,error:Ae,noData:Ge,emptyState:Ve,emptyIcon:ke,sidebarOpen:Ue,graphsAccordion:qe,chartIcon:Je,graphsContent:Ke,chartSection:Qe,chartSubtitle:Xe,trophySection:Ye,trophySectionTitle:Ze,trophyContainer:ea,trophy:aa,trophyIcon:sa,goldTrophy:na,silverTrophy:ra,bronzeTrophy:oa,trophyCount:ta},pa=()=>{const[v,U]=d.useState([]),[y,q]=d.useState(null),[i,C]=d.useState([]),[J,S]=d.useState(!0),[K,B]=d.useState(!1),[R,_]=d.useState(null),[u,T]=d.useState(!1),[f,Q]=d.useState(new Set),[x,X]=d.useState(!1);d.useEffect(()=>{Y()},[]);const l=d.useMemo(()=>{const s={tournamentsPlayed:i.length,totalWins:0,totalTies:0,totalLosses:0,mostPlayedRacePB:void 0,mostPlayedRacePBPercentage:0,mostPlayedRaceBF:void 0,mostPlayedRaceBFPercentage:0,winRatePB:0,winRateBF:0,firstPlaceCount:0,secondPlaceCount:0,thirdPlaceCount:0};if(i.length===0)return s;let n=0,t=0,c=0,o=0,M=0,j=0;i.forEach(r=>{r.standing&&(s.totalWins+=r.standing.wins,s.totalTies+=r.standing.ties,s.totalLosses+=r.standing.losses,r.standing.final_position===1?s.firstPlaceCount+=1:r.standing.final_position===2?s.secondPlaceCount+=1:r.standing.final_position===3&&(s.thirdPlaceCount+=1)),r.pbMatches&&r.pbMatches>0&&(n+=r.pbWins||0,t+=r.pbTies||0,c+=r.pbMatches),r.bfMatches&&r.bfMatches>0&&(o+=r.bfWins||0,M+=r.bfTies||0,j+=r.bfMatches)}),s.winRatePB=c>0?Math.min(100,Math.round((n+.5*t)/c*100)):0,s.winRateBF=j>0?Math.min(100,Math.round((o+.5*M)/j*100)):0;const m={},p={};i.forEach(r=>{r.races?.race_pb&&(m[r.races.race_pb]=(m[r.races.race_pb]||0)+1),r.races?.race_bf&&(p[r.races.race_bf]=(p[r.races.race_bf]||0)+1)});const L=Object.values(m).reduce((r,h)=>r+h,0),$=Object.values(p).reduce((r,h)=>r+h,0);if(Object.keys(m).length>0){const[r,h]=Object.entries(m).sort((N,g)=>g[1]-N[1])[0];s.mostPlayedRacePB=r,s.mostPlayedRacePBPercentage=L>0?Math.round(h/L*100):0}if(Object.keys(p).length>0){const[r,h]=Object.entries(p).sort((N,g)=>g[1]-N[1])[0];s.mostPlayedRaceBF=r,s.mostPlayedRaceBFPercentage=$>0?Math.round(h/$*100):0}return s},[i]),w=d.useMemo(()=>{const s={};return i.forEach(n=>{n.races?.race_pb&&(s[n.races.race_pb]=(s[n.races.race_pb]||0)+1)}),s},[i]),I=d.useMemo(()=>{const s={};return i.forEach(n=>{n.races?.race_bf&&(s[n.races.race_bf]=(s[n.races.race_bf]||0)+1)}),s},[i]),E=d.useMemo(()=>{const s={},n={};return i.forEach(t=>{if(t.races?.race_pb&&t.pbMatches&&t.pbMatches>0){const c=t.races.race_pb;n[c]||(n[c]={wins:0,ties:0,total:0}),n[c].wins+=t.pbWins||0,n[c].ties+=t.pbTies||0,n[c].total+=t.pbMatches}}),Object.entries(n).forEach(([t,c])=>{c.total>0&&(s[t]=Math.round((c.wins+.5*c.ties)/c.total*100))}),s},[i]),F=d.useMemo(()=>{const s={},n={};return i.forEach(t=>{if(t.races?.race_bf&&t.bfMatches&&t.bfMatches>0){const c=t.races.race_bf;n[c]||(n[c]={wins:0,ties:0,total:0}),n[c].wins+=t.bfWins||0,n[c].ties+=t.bfTies||0,n[c].total+=t.bfMatches}}),Object.entries(n).forEach(([t,c])=>{c.total>0&&(s[t]=Math.round((c.wins+.5*c.ties)/c.total*100))}),s},[i]),Y=async()=>{try{S(!0);const s=await oe.getPlayers();U(s.sort((n,t)=>n.name.localeCompare(t.name))),_(null)}catch(s){_("Error al cargar los jugadores. Por favor, intenta de nuevo."),console.error("Error fetching players:",s)}finally{S(!1)}},Z=s=>{const n=new Set(f);n.has(s)?n.delete(s):n.add(s),Q(n)},D=(s,n)=>{const t=["#6B46C1","#38A169","#D69E2E","#E53E3E","#3182CE","#805AD5","#DD6B20","#2C5282","#B83280","#38B2AC","#D4AF37","#C53030","#2D3748"],o=(n==="pb"?["Caballero","Faerie","Dragón","Olímpico","Titán","Héroe","Defensor","Desafiante","Sombra","Sacerdote","Faraón","Eterno","Tótem"]:["Caballero","Guerrero","Eterno","Sombra","Dragón","Bestia","Sacerdote","Ancestral","Héroe","Bárbaro","Tótem"]).indexOf(s);return o>=0?t[o%t.length]:"#6B46C1"},b=(s,n,t)=>(t==="pb"?["Caballero","Faerie","Dragón","Olímpico","Titán","Héroe","Defensor","Desafiante","Sombra","Sacerdote","Faraón","Eterno","Tótem"]:["Caballero","Guerrero","Eterno","Sombra","Dragón","Bestia","Sacerdote","Ancestral","Héroe","Bárbaro","Tótem"]).map(o=>({name:o,value:s[o]||0,winrate:n[o]||0,displayName:`${o}: ${s[o]||0}`})),ee=async s=>{q(s),T(!1),await ae(s.id)},ae=async s=>{try{B(!0);const n=await fetch(`${te}/players/${s}/tournaments`);if(!n.ok)throw new Error("Failed to fetch tournament data");const c=(await n.json()).map(o=>({tournamentId:o.tournament_id,tournamentName:o.tournament_name,month:o.month,year:o.year,standing:{final_position:o.final_position,matches_played:o.matches_played,wins:o.wins,ties:o.ties,losses:o.losses,points:o.points,total_points_scored:o.total_points_scored},races:{race_pb:o.race_pb,race_bf:o.race_bf},pbWins:o.pb_wins,pbTies:o.pb_ties,pbMatches:o.pb_matches,bfWins:o.bf_wins,bfTies:o.bf_ties,bfMatches:o.bf_matches}));C(c),_(null)}catch(n){_("Error al cargar la información del jugador."),console.error("Error loading player tournament data:",n),C([])}finally{B(!1)}};return e.jsxs("div",{className:a.container,children:[e.jsxs("div",{className:a.mobileHeader,children:[e.jsx("button",{className:a.hamburger,onClick:()=>T(!u),children:u?e.jsx(se,{size:24}):e.jsx(ne,{size:24})}),e.jsx("h1",{className:a.mobileTitle,children:"Jugadores"})]}),e.jsx("aside",{className:`${a.sidebar} ${u?a.sidebarOpen:""}`,children:e.jsxs("div",{className:a.sidebarContent,children:[e.jsxs("h2",{className:a.sidebarTitle,children:[e.jsx(H,{className:a.icon}),"Jugadores"]}),J?e.jsx("div",{className:a.loadingSpinner,children:"Cargando..."}):R?e.jsx("div",{className:a.error,children:R}):v.length===0?e.jsx("p",{className:a.noData,children:"No hay jugadores disponibles"}):e.jsx("ul",{className:a.playersList,children:v.map(s=>e.jsx("li",{children:e.jsx("button",{className:`${a.playerButton} ${y?.id===s.id?a.active:""}`,onClick:()=>ee(s),children:s.name})},s.id))})]})}),e.jsx("main",{className:a.main,children:y?e.jsxs("div",{className:a.playerDetail,children:[e.jsxs("div",{className:a.playerHeader,children:[e.jsxs("div",{className:a.playerInfoColumn,children:[e.jsx("div",{className:a.playerProfilePicture}),e.jsx("h1",{className:a.playerName,children:y.name}),i.length>0&&e.jsx("div",{className:a.trophySection,children:e.jsxs("div",{children:[e.jsx("h3",{className:a.trophySectionTitle,children:"Récord de Trofeos"}),e.jsxs("div",{className:a.trophyContainer,children:[e.jsxs("div",{className:a.trophy,children:[e.jsx(P,{className:`${a.trophyIcon} ${a.goldTrophy}`}),e.jsx("span",{className:a.trophyCount,children:l.firstPlaceCount})]}),e.jsxs("div",{className:a.trophy,children:[e.jsx(P,{className:`${a.trophyIcon} ${a.silverTrophy}`}),e.jsx("span",{className:a.trophyCount,children:l.secondPlaceCount})]}),e.jsxs("div",{className:a.trophy,children:[e.jsx(P,{className:`${a.trophyIcon} ${a.bronzeTrophy}`}),e.jsx("span",{className:a.trophyCount,children:l.thirdPlaceCount})]})]})]})})]}),i.length>0&&e.jsxs("div",{className:a.playerSummary,children:[e.jsxs("div",{className:a.summaryItem,children:[e.jsx("span",{className:a.summaryLabel,children:"Récord Global:"}),e.jsxs("span",{className:a.summaryValue,children:[l.totalWins,"G - ",l.totalTies,"E - ",l.totalLosses,"P"]})]}),e.jsxs("div",{className:a.summaryItem,children:[e.jsx("span",{className:a.summaryLabel,children:"Torneos Participados:"}),e.jsx("span",{className:a.summaryValue,children:l.tournamentsPlayed})]}),e.jsxs("div",{className:a.summaryItem,children:[e.jsx("span",{className:a.summaryLabel,children:"Raza más jugada PB:"}),e.jsx("span",{className:a.summaryValue,children:l.mostPlayedRacePB?`${l.mostPlayedRacePB} (${l.mostPlayedRacePBPercentage}%)`:"-"})]}),e.jsxs("div",{className:a.summaryItem,children:[e.jsx("span",{className:a.summaryLabel,children:"WinRate Global en PB:"}),e.jsxs("span",{className:a.summaryValue,children:[l.winRatePB,"%"]})]}),e.jsxs("div",{className:a.summaryItem,children:[e.jsx("span",{className:a.summaryLabel,children:"Raza más jugada BF:"}),e.jsx("span",{className:a.summaryValue,children:l.mostPlayedRaceBF?`${l.mostPlayedRaceBF} (${l.mostPlayedRaceBFPercentage}%)`:"-"})]}),e.jsxs("div",{className:a.summaryItem,children:[e.jsx("span",{className:a.summaryLabel,children:"WinRate Global en BF:"}),e.jsxs("span",{className:a.summaryValue,children:[l.winRateBF,"%"]})]})]})]}),i.length>0&&e.jsxs("div",{className:a.graphsAccordion,children:[e.jsxs("button",{className:a.accordionHeader,onClick:()=>X(!x),children:[e.jsx("div",{className:a.headerContent,children:e.jsxs("h3",{children:[e.jsx(re,{className:a.chartIcon})," Estadísticas de Razas"]})}),e.jsx(O,{className:`${a.chevron} ${x?a.expanded:""}`})]}),x&&e.jsxs("div",{className:a.graphsContent,children:[e.jsxs("div",{className:a.chartSection,children:[e.jsx("h4",{children:"Uso de Razas en Primer Bloque"}),e.jsx("p",{className:a.chartSubtitle,children:"(WinRate% con esa Raza)"}),e.jsx(W,{width:"100%",height:300,children:e.jsxs(z,{children:[e.jsx(A,{data:b(w,E,"pb"),cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:s=>{const n=s;return n.value>0?`${n.value} (${n.winrate}%)`:""},labelLine:!1,children:b(w,E,"pb").map((s,n)=>e.jsx(G,{fill:D(s.name,"pb")},`cell-${n}`))}),e.jsx(V,{}),e.jsx(k,{formatter:(s,n)=>n.payload.displayName,wrapperStyle:{color:"var(--coal-grey)"}})]})})]}),e.jsxs("div",{className:a.chartSection,children:[e.jsx("h4",{children:"Uso de Razas en Bloque Furia"}),e.jsx("p",{className:a.chartSubtitle,children:"(WinRate% con esa Raza)"}),e.jsx(W,{width:"100%",height:300,children:e.jsxs(z,{children:[e.jsx(A,{data:b(I,F,"bf"),cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:s=>{const n=s;return n.value>0?`${n.value} (${n.winrate}%)`:""},labelLine:!1,children:b(I,F,"bf").map((s,n)=>e.jsx(G,{fill:D(s.name,"bf")},`cell-${n}`))}),e.jsx(V,{}),e.jsx(k,{formatter:(s,n)=>n.payload.displayName,wrapperStyle:{color:"var(--coal-grey)"}})]})})]})]})]}),K?e.jsx("div",{className:a.loadingSpinner,children:"Cargando datos del jugador..."}):i.length===0?e.jsx("p",{className:a.noData,children:"Este jugador no ha participado en ningún torneo."}):e.jsx("div",{className:a.tournamentsList,children:i.map(s=>e.jsxs("div",{className:a.tournamentCard,children:[e.jsxs("button",{className:a.accordionHeader,onClick:()=>Z(s.tournamentId),children:[e.jsxs("div",{className:a.headerContent,children:[e.jsx("h3",{children:s.tournamentName}),e.jsxs("span",{className:a.tournamentDate,children:[s.month," ",s.year]})]}),e.jsx(O,{className:`${a.chevron} ${f.has(s.tournamentId)?a.expanded:""}`})]}),f.has(s.tournamentId)&&e.jsxs("div",{className:a.tournamentInfo,children:[s.standing&&e.jsxs("div",{className:a.standingInfo,children:[e.jsxs("div",{className:a.infoRow,children:[e.jsx("span",{className:a.label,children:"Posición:"}),e.jsxs("span",{className:a.value,children:[s.standing.final_position,"°"]})]}),e.jsxs("div",{className:a.infoRow,children:[e.jsx("span",{className:a.label,children:"Récord (Rondas):"}),e.jsxs("span",{className:a.value,children:[s.standing.wins,"G - ",s.standing.ties,"E - ",s.standing.losses,"P"]})]}),e.jsxs("div",{className:a.infoRow,children:[e.jsx("span",{className:a.label,children:"Puntos:"}),e.jsx("span",{className:a.value,children:s.standing.points})]}),e.jsxs("div",{className:a.infoRow,children:[e.jsx("span",{className:a.label,children:"Partidas Individuales Ganadas:"}),e.jsx("span",{className:a.value,children:s.standing.total_points_scored})]})]}),s.races&&e.jsxs("div",{className:a.racesInfo,children:[e.jsxs("div",{className:a.infoRow,children:[e.jsx("span",{className:a.label,children:"Raza PB:"}),e.jsx("span",{className:a.value,children:s.races.race_pb||"No registrada"})]}),e.jsxs("div",{className:a.infoRow,children:[e.jsx("span",{className:a.label,children:"Raza BF:"}),e.jsx("span",{className:a.value,children:s.races.race_bf||"No registrada"})]})]})]})]},s.tournamentId))})]}):e.jsxs("div",{className:a.emptyState,children:[e.jsx(H,{className:a.emptyIcon}),e.jsx("p",{children:"Selecciona un jugador para ver su historial de torneos"})]})})]})};export{pa as default};
